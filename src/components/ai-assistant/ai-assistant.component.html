<div class="fixed inset-0 bg-black/60 z-[9990] flex items-center justify-center p-4" (click)="close.emit()">
    <div class="bg-sky-50 w-full max-w-lg max-h-[90vh] rounded-3xl shadow-2xl flex flex-col animate-fade-in-up" (click)="$event.stopPropagation()">
        <!-- Header -->
        <div class="p-5 border-b border-sky-200 flex justify-between items-center flex-shrink-0">
            <div class="flex items-center gap-3">
                 <div class="bg-teal-100 text-teal-600 p-2 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
                </div>
                <div>
                    <h3 class="font-bold text-sky-800 text-lg leading-tight">Bantuan AI - Fasiliti Perubatan</h3>
                    <p class="text-xs text-slate-500 font-semibold">Mencari hospital & klinik berdekatan lokasi anda.</p>
                </div>
            </div>
            <button (click)="close.emit()" class="p-2 bg-sky-100 rounded-full text-sky-600 hover:bg-sky-200 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        
        <!-- Content -->
        <div class="p-5 overflow-y-auto">
            @if (isLoading()) {
                <app-loading-indicator message="AI sedang memproses lokasi anda..."></app-loading-indicator>
            } @else if (error()) {
                <div class="text-center py-8 bg-red-50/50 rounded-[32px] border border-dashed border-red-200">
                    <p class="font-bold text-red-700">Gagal Mendapatkan Data</p>
                    <p class="text-xs text-red-600 mt-2 px-4">{{ error() }}</p>
                    <button (click)="findFacilities()" class="mt-4 bg-sky-100 text-sky-700 text-xs font-bold px-4 py-2 rounded-lg hover:bg-sky-200 transition-colors">
                        Cuba Semula
                    </button>
                </div>
            } @else if (facilities().length === 0) {
                 <div class="text-center py-8 bg-white/50 rounded-[32px] border border-dashed border-sky-200">
                    <p class="text-sm font-bold text-slate-600">Tiada Fasiliti Ditemui</p>
                    <p class="text-xs text-slate-400 mt-1">AI tidak dapat mencari fasiliti perubatan berdekatan lokasi anda.</p>
                </div>
            } @else {
                <div class="space-y-6">
                    <!-- Hospitals -->
                    @if (hospitals().length > 0) {
                        <div class="space-y-3">
                            <h4 class="text-xs font-black text-red-600 uppercase tracking-widest">Hospital</h4>
                            @for (hospital of hospitals(); track hospital.nama) {
                                <div class="bg-white p-4 rounded-xl border border-slate-200 flex justify-between items-center gap-3">
                                    <div class="flex-grow">
                                        <p class="font-bold text-slate-800">{{ hospital.nama }}</p>
                                        <p class="text-sm font-semibold text-slate-500">{{ hospital.jarak }}</p>
                                    </div>
                                    <button (click)="openInMaps(hospital.nama)" class="flex-shrink-0 bg-sky-100 text-sky-700 px-3 py-2 rounded-lg hover:bg-sky-200 transition-colors text-xs font-bold flex items-center gap-2" title="Buka di Peta">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21 3 6"/><line x1="9" y1="3" x2="9" y2="18"/><line x1="15" y1="6" x2="15" y2="21"/></svg>
                                        <span>Peta</span>
                                    </button>
                                </div>
                            }
                        </div>
                    }
                    <!-- Clinics -->
                     @if (clinics().length > 0) {
                        <div class="space-y-3">
                            <h4 class="text-xs font-black text-blue-600 uppercase tracking-widest">Klinik</h4>
                            @for (clinic of clinics(); track clinic.nama) {
                                <div class="bg-white p-4 rounded-xl border border-slate-200 flex justify-between items-center gap-3">
                                    <div class="flex-grow">
                                        <p class="font-bold text-slate-800">{{ clinic.nama }}</p>
                                        <p class="text-sm font-semibold text-slate-500">{{ clinic.jarak }}</p>
                                    </div>
                                    <button (click)="openInMaps(clinic.nama)" class="flex-shrink-0 bg-sky-100 text-sky-700 px-3 py-2 rounded-lg hover:bg-sky-200 transition-colors text-xs font-bold flex items-center gap-2" title="Buka di Peta">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21 3 6"/><line x1="9" y1="3" x2="9" y2="18"/><line x1="15" y1="6" x2="15" y2="21"/></svg>
                                        <span>Peta</span>
                                    </button>
                                </div>
                            }
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>