<div class="space-y-4">
    <!-- Program Settings -->
    <div class="bg-white p-6 rounded-[32px] shadow-sm border border-sky-50">
        <h4 class="font-bold text-sky-800 text-base">Pengurusan Program</h4>
        <p class="text-xs text-slate-400 mt-1">Tambah atau semak maklumat program di Cloud.</p>
        
        <div class="grid grid-cols-3 gap-3 mt-4">
            <button (click)="toggleProgramForm()" [disabled]="!stateSvc.isCloudConnected() && !stateSvc.isSimulationMode()" class="w-full bg-sky-50 text-sky-700 py-3 rounded-xl border border-sky-100 font-bold text-xs hover:bg-sky-100 transition-colors disabled:bg-slate-100 disabled:text-slate-400 disabled:cursor-not-allowed flex flex-col items-center justify-center gap-1.5 h-20">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                <span>{{ isProgramFormVisible() ? 'Tutup' : 'Baru' }}</span>
            </button>
            <button (click)="checkLatestProgram()" [disabled]="!stateSvc.isCloudConnected() || isCheckingLatestProgram()" class="w-full bg-sky-50 text-sky-700 py-3 rounded-xl border border-sky-100 font-bold text-xs hover:bg-sky-100 transition-colors disabled:bg-slate-100 disabled:text-slate-400 disabled:cursor-not-allowed flex flex-col items-center justify-center gap-1.5 h-20">
                @if (isCheckingLatestProgram()) {
                    <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                }
                <span>Terkini</span>
            </button>
            <button (click)="checkNextCloudId()" [disabled]="!stateSvc.isCloudConnected() || isCheckingNextId()" class="w-full bg-sky-50 text-sky-700 py-3 rounded-xl border border-sky-100 font-bold text-xs hover:bg-sky-100 transition-colors disabled:bg-slate-100 disabled:text-slate-400 disabled:cursor-not-allowed flex flex-col items-center justify-center gap-1.5 h-20">
                @if (isCheckingNextId()) {
                    <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 16.5A6.5 6.5 0 1 1 17.4 8.1"/><circle cx="15.5" cy="15.5" r="2.5"/><path d="M17.5 17.5 L19.5 19.5"/></svg>
                }
                <span>Semak ID</span>
            </button>
        </div>
        <div class="mt-4">
            <button (click)="openProgramListModal()" [disabled]="!stateSvc.isCloudConnected() && !stateSvc.isSimulationMode()" class="w-full text-center text-sky-700 text-sm font-bold py-3 hover:bg-sky-50 rounded-xl transition-colors border border-sky-200 bg-sky-50/50 disabled:bg-slate-100 disabled:text-slate-400">
                Papar Senarai Program Penuh
            </button>
        </div>

        @if (isCheckingNextId() || nextCloudId()) {
            <div class="mt-4 pt-4 border-t border-slate-100">
                <label class="text-[10px] font-black text-slate-400 uppercase ml-2 tracking-widest">ID Cloud Seterusnya</label>
                @if (isCheckingNextId()) {
                    <div class="mt-1">
                        <app-loading-indicator size="small" message="Menyemak ID dari Cloud..."></app-loading-indicator>
                    </div>
                } @else if (nextCloudId()) {
                    <input type="text" [value]="nextCloudId()" readonly class="w-full mt-1 p-3 bg-slate-100 border-0 rounded-xl text-sm font-semibold text-slate-500 focus:ring-0 outline-none cursor-not-allowed">
                }
            </div>
        }

        @if (!stateSvc.isCloudConnected() && !stateSvc.isSimulationMode()) {
             <p class="text-center text-xs text-amber-600 mt-3 bg-amber-50 p-2 rounded-lg border border-amber-100">Sila sambung ke Cloud atau aktifkan mod simulasi untuk mengurus program.</p>
        }

        @if (isProgramFormVisible() && (stateSvc.isCloudConnected() || stateSvc.isSimulationMode())) {
            <div class="mt-4 pt-4 border-t border-slate-100 space-y-4">
                <form [formGroup]="programForm" (ngSubmit)="saveProgram()">
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 tracking-widest">ID Program</label>
                        <div class="mt-1">
                            <input type="text" [value]="programId()" readonly class="w-full p-3 bg-slate-100 border-0 rounded-xl text-sm font-semibold text-slate-500 focus:ring-0 outline-none cursor-not-allowed">
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 tracking-widest">Nama Program</label>
                        <input formControlName="name" type="text" placeholder="Nama Program" class="w-full p-3 mt-1 bg-slate-50 border-0 rounded-xl text-sm font-semibold focus:ring-2 focus:ring-sky-500 outline-none">
                    </div>
                     <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-black text-slate-400 uppercase ml-2 tracking-widest">Tarikh</label>
                            <input formControlName="date" type="date" class="w-full p-3 mt-1 bg-slate-50 border-0 rounded-xl text-sm font-semibold focus:ring-2 focus:ring-sky-500 outline-none">
                        </div>
                        <div>
                           <label class="text-[10px] font-black text-slate-400 uppercase ml-2 tracking-widest">Masa</label>
                           <input formControlName="time" type="time" class="w-full p-3 mt-1 bg-slate-50 border-0 rounded-xl text-sm font-semibold focus:ring-2 focus:ring-sky-500 outline-none">
                        </div>
                    </div>
                     <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2 tracking-widest">Lokasi</label>
                        <input formControlName="location" type="text" placeholder="Lokasi Program" class="w-full p-3 mt-1 bg-slate-50 border-0 rounded-xl text-sm font-semibold focus:ring-2 focus:ring-sky-500 outline-none">
                    </div>

                    <div class="flex justify-end pt-2">
                        <button type="submit" [disabled]="programForm.invalid" class="bg-sky-600 text-white text-sm font-black py-3 px-6 rounded-xl disabled:bg-slate-300 active:scale-95 transition-transform shadow-lg shadow-sky-200/50 disabled:shadow-none">
                            {{ stateSvc.isSimulationMode() ? 'CIPTA SIMULasi' : 'SIMPAN KE CLOUD' }}
                        </button>
                    </div>
                </form>
            </div>
        }
    </div>

     <!-- Advanced Configuration (Collapsible) -->
    <div class="bg-white p-6 rounded-[32px] shadow-sm border border-sky-50">
        <div (click)="toggleConfigVisibility()" class="flex justify-between items-center cursor-pointer">
            <div>
                <h4 class="font-bold text-sky-800 text-base">Konfigurasi & Diagnostik</h4>
                <p class="text-xs text-slate-400 mt-1">Urus sambungan Cloud & sistem.</p>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-slate-400 transition-transform duration-300" [class.rotate-180]="isConfigVisible()">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </div>

        @if (isConfigVisible()) {
            <div class="mt-4 pt-4 border-t border-slate-100 space-y-6">
                <!-- Backend Settings Section -->
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <h5 class="font-bold text-sky-700 text-sm">Sambungan Cloud</h5>
                         @if (stateSvc.isSimulationMode()) {
                             <span class="text-xs font-black px-2.5 py-1 rounded-full border bg-amber-100 text-amber-700 border-amber-200">SIMULASI</span>
                         } @else if (stateSvc.isCloudConnected()) {
                            <span class="text-xs font-black px-2.5 py-1 rounded-full border bg-sky-50 text-sky-600 border-sky-200">DALAM TALIAN</span>
                        } @else {
                            <span class="text-xs font-black px-2.5 py-1 rounded-full border bg-red-50 text-red-600 border-red-200">LUAR TALIAN</span>
                        }
                    </div>
                    <div class="pt-2 space-y-3" [class.opacity-50]="stateSvc.isSimulationMode()">
                        <button (click)="testConnection()" [disabled]="!stateSvc.gasUrl() || isTesting() || stateSvc.isSimulationMode()" class="w-full bg-sky-600 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-sky-100 active:scale-95 transition-all disabled:bg-slate-300 disabled:shadow-none">
                            <div class="flex items-center justify-center gap-2">
                                <svg [class.animate-spin]="isTesting()" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                                <span>{{ isTesting() ? 'MENGUJI...' : 'UJI SAMBUNGAN' }}</span>
                            </div>
                        </button>
                        <button (click)="toggleBackendSetup()" class="w-full text-center text-sky-700 text-xs font-bold py-2 hover:bg-sky-50 rounded-lg transition-colors" [disabled]="stateSvc.isSimulationMode()">
                            {{ isBackendSetupVisible() ? 'Tutup Tetapan URL' : 'Urus URL' }}
                        </button>
                    </div>
                    @if (isBackendSetupVisible() && !stateSvc.isSimulationMode()) {
                        <div class="mt-4 pt-4 border-t border-slate-100 space-y-3">
                            <form [formGroup]="backendForm" (ngSubmit)="verifyCloud()">
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2 tracking-widest">URL Google Script</label>
                                    <input type="text" formControlName="url" placeholder="Masukkan URL Script Cloud" class="w-full p-4 mt-1 bg-slate-50 border-0 rounded-2xl text-sm font-semibold focus:ring-2 focus:ring-sky-500 outline-none" [readOnly]="stateSvc.isCloudConnected()">
                                </div>
                                @if (!stateSvc.isCloudConnected()) {
                                    <button type="submit" [disabled]="isVerifying() || backendForm.invalid" class="w-full bg-sky-600 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-sky-100 active:scale-95 transition-all disabled:bg-slate-300 disabled:shadow-none">
                                        {{ isVerifying() ? 'Mengesahkan...' : 'SAHKAN' }}
                                    </button>
                                } @else {
                                    <button type="button" (click)="resetCloud()" class="w-full bg-slate-600 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-slate-200 active:scale-95 transition-all">
                                        RESET
                                    </button>
                                }
                            </form>
                        </div>
                    }
                </div>
                
                <!-- Diagnostics Section -->
                <div class="space-y-2">
                    <h5 class="font-bold text-sky-700 text-sm">Diagnostik Sistem</h5>
                    <div class="pt-2 space-y-3" [class.opacity-50]="stateSvc.isSimulationMode()">
                        <button (click)="validateSheetStructure()" [disabled]="!stateSvc.isCloudConnected() || isCheckingStructure() || stateSvc.isSimulationMode()" class="w-full bg-amber-500 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-amber-100/50 active:scale-95 transition-all disabled:bg-slate-300 disabled:shadow-none">
                            <div class="flex items-center justify-center gap-2">
                                <svg [class.animate-spin]="isCheckingStructure()" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15.5 6.5C15.5 5.26 14.53 4 13.06 4H6.52C5.1 4 4.07 5.26 4.07 6.5V17.5c0 1.24 1.03 2.5 2.45 2.5h8.51c1.42 0 2.47-1.26 2.47-2.5v-3.5"/><path d="m14 10 3-3-3-3"/><path d="M17 7H9"/><path d="m14 14 3-3-3-3"/><path d="M17 11H9"/></svg>
                                <span>{{ isCheckingStructure() ? 'MENYEMAK...' : 'SEMAK SEMUA HELAIAN' }}</span>
                            </div>
                        </button>
                         <button (click)="showConfigInfo()" [disabled]="!stateSvc.isCloudConnected() || stateSvc.isSimulationMode()" class="w-full bg-slate-500 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-slate-200/50 active:scale-95 transition-all disabled:bg-slate-300 disabled:shadow-none">
                            <div class="flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                                <span>PAPAR INFO</span>
                            </div>
                        </button>
                        <button (click)="openDatabaseSheet()" [disabled]="!stateSvc.isCloudConnected() || stateSvc.isSimulationMode()" class="w-full bg-blue-500 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-blue-100/50 active:scale-95 transition-all disabled:bg-slate-300 disabled:shadow-none">
                            <div class="flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                                <span>BUKA PANGKALAN DATA</span>
                            </div>
                        </button>
                        <button (click)="showSampleDataConfirm()" [disabled]="!stateSvc.isCloudConnected() || isAddingSampleData() || stateSvc.isSimulationMode()" class="w-full bg-emerald-500 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-emerald-100/50 active:scale-95 transition-all disabled:bg-slate-300 disabled:shadow-none">
                            <div class="flex items-center justify-center gap-2">
                                @if(isAddingSampleData()) {
                                    <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                                } @else {
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><path d="M14 8v11"/><path d="M8 19h10"/><path d="M10 9H8"/></svg>
                                }
                                <span>{{ isAddingSampleData() ? 'MENAMBAH...' : 'TAMBAH DATA SAMPEL' }}</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Simulation Data Section -->
                @if (stateSvc.isSimulationMode()) {
                    <div class="space-y-2">
                        <h5 class="font-bold text-sky-700 text-sm">Data Simulasi</h5>
                        <div class="pt-2 space-y-3">
                            <p class="text-xs text-slate-500 bg-slate-50 p-3 rounded-lg border border-slate-200">
                                Berikut ialah data semasa yang dijana dalam sesi simulasi ini. Anda boleh muat turun data ini sebagai fail JSON untuk simpanan atau untuk dipindahkan ke Google Sheets.
                            </p>
                            <div class="bg-slate-800 text-white rounded-xl p-4 max-h-60 overflow-auto text-xs font-mono">
                                <pre>{{ simulationData() | json }}</pre>
                            </div>
                            <button (click)="downloadSimulationData()" class="w-full bg-emerald-500 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-emerald-100/50 active:scale-95 transition-all">
                                <div class="flex items-center justify-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                    <span>MUAT TURUN DATA JSON</span>
                                </div>
                            </button>
                        </div>
                    </div>
                }
            </div>
        }
    </div>

    <!-- Version Info (Collapsible) -->
    <div class="bg-white p-6 rounded-[32px] shadow-sm border border-sky-50">
        <div (click)="toggleVersionInfoVisibility()" class="flex justify-between items-center cursor-pointer">
            <div>
                <h4 class="font-bold text-sky-800 text-base">Version Info</h4>
                <p class="text-xs text-slate-400 mt-1">Lihat ciri-ciri baru dan kemajuan sistem.</p>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-slate-400 transition-transform duration-300" [class.rotate-180]="isVersionInfoVisible()">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </div>

        @if (isVersionInfoVisible()) {
            <div class="mt-4 pt-4 border-t border-slate-100 space-y-6">
                <div>
                    <button (click)="saveFeaturesToDocs()" [disabled]="stateSvc.isSimulationMode() || isSavingToDocs()" class="w-full bg-sky-600 text-white p-4 rounded-2xl font-black text-xs shadow-lg shadow-sky-100 active:scale-95 transition-all disabled:bg-slate-300 disabled:shadow-none">
                        <div class="flex items-center justify-center gap-2">
                            @if(isSavingToDocs()) {
                                <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                                <span>MENYIMPAN KE DRIVE...</span>
                            } @else {
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                                <span>SIMPAN SEBAGAI GOOGLE DOC</span>
                            }
                        </div>
                    </button>
                    @if(stateSvc.isSimulationMode()) {
                        <p class="text-center text-xs text-slate-400 mt-2">Fungsi ini dilumpuhkan dalam Mod Simulasi.</p>
                    }
                </div>
                <!-- Live & Common Features -->
                <div>
                    <h4 class="text-xs font-black text-sky-600 uppercase tracking-widest mb-3">Mod Langsung & Umum</h4>
                    <div class="space-y-3">
                        @for (feature of liveAndCommonFeatures; track feature.version) {
                            <div class="text-slate-800">
                                <p class="font-bold text-sm flex items-center gap-2">
                                    {{ feature.title }}
                                    @if (feature.version >= 2.4) {
                                        <span class="text-[9px] font-black px-2 py-0.5 rounded-full bg-sky-100 text-sky-700">BARU</span>
                                    }
                                </p>
                                <p class="text-xs text-slate-500 mt-0.5">{{ feature.description }}</p>
                            </div>
                        }
                    </div>
                </div>
                <!-- Simulation Features -->
                <div>
                    <h4 class="text-xs font-black text-amber-600 uppercase tracking-widest mb-3">Mod Simulasi</h4>
                    <div class="space-y-3">
                         @for (feature of simulationFeatures; track feature.version) {
                            <div class="text-slate-800">
                                <p class="font-bold text-sm flex items-center gap-2">
                                    {{ feature.title }}
                                     @if (feature.version >= 2.2) {
                                        <span class="text-[9px] font-black px-2 py-0.5 rounded-full bg-amber-100 text-amber-700">BARU</span>
                                    }
                                </p>
                                <p class="text-xs text-slate-500 mt-0.5">{{ feature.description }}</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<!-- Full screen modal for program list -->
@if (isProgramListModalVisible()) {
    <div class="fixed inset-0 bg-black/60 z-[9990] flex items-center justify-center p-4" (click)="closeProgramListModal()">
        <div class="bg-sky-50 w-full max-w-lg max-h-[90vh] rounded-3xl shadow-2xl flex flex-col" (click)="$event.stopPropagation()">
            <div class="p-5 border-b border-sky-200 flex justify-between items-center flex-shrink-0">
                <h3 class="font-bold text-sky-800 text-lg">Senarai Program Direkodkan</h3>
                <button (click)="closeProgramListModal()" class="p-2 bg-sky-100 rounded-full text-sky-600 hover:bg-sky-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="p-5 overflow-y-auto space-y-3">
                @if (isLoadingPrograms()) {
                    <app-loading-indicator message="Memuat turun data dari Cloud..."></app-loading-indicator>
                } @else if (allPrograms().length === 0) {
                    <p class="text-center text-slate-500 py-10">Tiada program ditemui dalam rekod.</p>
                } @else {
                    @for (prog of allPrograms(); track prog.id) {
                        <div class="bg-white rounded-2xl p-4 border border-slate-100">
                            <p class="font-bold text-slate-800">{{ prog.namaprogram }}</p>
                            <p class="text-xs font-mono text-sky-700 bg-sky-50 px-2 py-0.5 rounded mt-1 inline-block">{{ prog.id }}</p>
                            <div class="mt-3 pt-3 border-t border-slate-100 grid grid-cols-3 gap-2 text-xs">
                                <div>
                                    <p class="font-bold text-slate-400">Tarikh</p>
                                    <p class="font-semibold text-slate-600">{{ formatDate(prog.tarikh) }}</p>
                                </div>
                                <div>
                                    <p class="font-bold text-slate-400">Masa</p>
                                    <p class="font-semibold text-slate-600">{{ formatTime(prog.masa) }}</p>
                                </div>
                                <div>
                                    <p class="font-bold text-slate-400">Lokasi</p>
                                    <p class="font-semibold text-slate-600">{{ prog.lokasi }}</p>
                                </div>
                            </div>
                            <div class="mt-4 pt-3 border-t border-slate-100 flex items-center justify-end gap-2">
                                <button (click)="activateProgram(prog)" [disabled]="stateSvc.activeProgram()?.id === prog.id || lockingProgramId() === prog.id" class="text-xs font-bold bg-sky-500 text-white px-4 py-2 rounded-lg hover:bg-sky-600 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed flex items-center justify-center gap-1.5 w-28">
                                    @if(lockingProgramId() === prog.id) {
                                        <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                                        <span>Mengaktifkan</span>
                                    } @else {
                                        <span>Aktifkan</span>
                                    }
                                </button>
                                <button (click)="toggleLockProgram(prog, $event)" [disabled]="lockingProgramId() === prog.id" class="text-xs font-bold px-4 py-2 rounded-lg transition-colors flex items-center gap-1.5" [class.bg-red-100]="!prog.locked" [class.text-red-700]="!prog.locked" [class.hover:bg-red-200]="!prog.locked" [class.bg-slate-100]="prog.locked" [class.text-slate-700]="prog.locked" [class.hover:bg-slate-200]="prog.locked" [class.bg-slate-200]="lockingProgramId() === prog.id" [class.cursor-wait]="lockingProgramId() === prog.id">
                                    @if (lockingProgramId() === prog.id) {
                                        <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                                        <span>Mengemas kini...</span>
                                    } @else if (prog.locked) {
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></svg>
                                        <span>Buka Kunci</span>
                                    } @else {
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                        <span>Kunci</span>
                                    }
                                </button>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
}

<!-- Add Sample Data Confirmation Modal -->
@if (isSampleDataConfirmVisible()) {
  <div class="fixed inset-0 bg-black/60 z-[9998] flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl p-6 shadow-xl w-full max-w-sm text-center animate-fade-in-up">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-amber-500 mb-4"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
        <h3 class="font-bold text-lg text-slate-800">Tambah Data Sampel?</h3>
        <p class="text-sm text-slate-500 mt-2">Ini akan menambah data sampel (cekpoint & ambulans) ke program terkini di Google Sheets anda. Tindakan ini tidak boleh diundur.</p>
        <div class="grid grid-cols-2 gap-3 mt-6">
            <button (click)="hideSampleDataConfirm()" class="bg-slate-100 text-slate-700 font-bold py-3 rounded-xl hover:bg-slate-200 transition-colors">
                Batal
            </button>
            <button (click)="confirmAddSampleData()" class="bg-amber-500 text-white font-bold py-3 rounded-xl hover:bg-amber-600 transition-colors">
                Ya, Tambah
            </button>
        </div>
    </div>
  </div>
}